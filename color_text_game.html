<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ColorTextGame</title>
    <style>
        /* --- å…¨åŸŸè¨­å®š --- */
        :root {
            /* ä¸»è‰²ç³» */
            --primary-blue: #53B4FF; 
            /* è¼”åŠ©æ·ºè— */
            --sky-blue: #C4E6FF;     
            --bg-color: #FFFFFF;
            --text-grey: #888888;
            --card-transition: 0.2s;
            --card-gap: 10px;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            margin: 0;
            padding: 20px 10px;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }

        /* --- æ¨™é¡Œèˆ‡èªªæ˜ --- */
        header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 480px;
        }

        h1 {
            font-size: 32px;
            margin: 0 0 8px 0;
            color: var(--primary-blue);
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        p.desc {
            font-size: 20px;
            color: var(--text-grey);
            margin: 0;
            font-weight: 400;
        }

        /* --- æ§åˆ¶å€ (é›£åº¦ + åˆ†æ•¸ + è¨ˆæ™‚) --- */
        .controls-wrapper {
            width: 100%;
            max-width: 480px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        /* é›£åº¦åˆ‡æ› */
        .difficulty-bar {
            display: flex;
            background: #F8FBFF;
            padding: 4px;
            border-radius: 12px;
            width: 100%;
            border: 1px solid #EEF5FF;
        }

        .mode-btn {
            background: transparent;
            border: none;
            flex: 1;
            padding: 10px 0;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--text-grey);
            cursor: pointer;
            transition: all var(--card-transition);
        }

        .mode-btn.active {
            background-color: var(--primary-blue);
            color: #FFFFFF;
            box-shadow: 0 2px 6px rgba(83, 180, 255, 0.4);
        }

        /* ç‹€æ…‹åˆ— (åˆ†æ•¸ + è¨ˆæ™‚é–‹é—œ) */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5px;
        }

        .score-box {
            font-size: 1rem;
            font-weight: bold;
            color: var(--primary-blue);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .score-val {
            font-size: 1.2rem;
            background: #F0F8FF;
            padding: 2px 10px;
            border-radius: 12px;
        }

        /* è¨ˆæ™‚æ¨¡å¼é–‹é—œ */
        .timer-toggle {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: var(--text-grey);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px;
            margin-left: 8px;
        }

        .switch input { opacity: 0; width: 0; height: 0; }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #EEE;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-blue);
        }

        input:checked + .slider:before {
            transform: translateX(18px);
        }

        /* --- éŠæˆ²ä¸»å€åŸŸ --- */
        #game-container {
            width: 100%;
            max-width: 480px;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* å¡ç‰‡ç¶²æ ¼ */
        .grid {
            display: grid;
            width: 98%;
            gap: var(--card-gap);
            margin-bottom: 20px;
            grid-template-columns: repeat(2, 1fr); 
        }

        .card {
            aspect-ratio: 1 / 0.8;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem; 
            font-weight: 900;
            border-radius: 12px;
            border: 2px solid #EEE;
            background: #FFF;
            transition: opacity 0.3s;
            user-select: none;
        }
        
        .card.hidden {
            opacity: 0; 
            pointer-events: none;
        }

        /* --- å€’æ•¸è¨ˆæ™‚æ¢ --- */
        .timer-bar-container {
            width: 100%;
            height: 8px;
            background: #F0F0F0;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }
        
        .timer-bar-fill {
            height: 100%;
            width: 100%;
            background: var(--primary-blue);
            transform-origin: left;
            border-radius: 4px;
        }

        /* --- äº’å‹•èˆ‡å•ç­”å€ --- */
        .action-area {
            width: 100%;
            max-width: 480px;
            text-align: center;
            margin-top: -10px;
            padding-bottom: 20px;
            min-height: 150px;
            position: relative;
        }

        .btn-main {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 16px 48px;
            font-size: 1.2rem;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            max-width: 480px;
            transition: transform 0.1s, opacity 0.2s;
            box-shadow: 0 4px 15px rgba(83, 180, 255, 0.35); 
        }

        .btn-main:active {
            transform: scale(0.98);
        }

        .question-box {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .question-text {
            font-size: 1.3rem;
            margin-bottom: 20px;
            line-height: 1.4;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        /* é¡Œç›®å…§å®¹æ¨£å¼ */
        .q-content-text {
            color: var(--primary-blue);
            font-weight: bold;
            font-size: 1.6rem;
            margin-top: 8px;
        }

        .q-color-dot {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-top: 8px;
            vertical-align: middle;
            /* ç§»é™¤é™°å½±ï¼Œä¿ç•™æ¥µç´°å¾®é‚Šæ¡†ä»¥å€åˆ†æ·ºè‰² */
            box-shadow: none;
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* æ•¸å­—éµç›¤å®¹å™¨ */
        .numpad-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
        }

        .numpad-row {
            display: flex;
            justify-content: center;
            gap: 12px;
            width: 100%;
        }

        .num-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: 2px solid var(--sky-blue);
            background: white;
            color: var(--primary-blue);
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        .num-btn:active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        /* çµæœé¡¯ç¤º */
        .result-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.96);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            display: none;
        }

        .result-title {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        .result-sub {
            font-size: 1.2rem;
            color: var(--text-grey);
            margin-bottom: 30px;
            font-weight: bold;
        }

        /* å‹•ç•« */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes timerShrink {
            from { transform: scaleX(1); }
            to { transform: scaleX(0); }
        }

        /* æ–‡å­—é¡è‰²å®šç¾© */
        .c-red { color: #E63946; }
        .c-green { color: #2A9D8F; }
        .c-blue { color: #53B4FF; } 
        .c-yellow { color: #F4A261; }
        .c-black { color: #333333; }

    </style>
</head>
<body>

    <header>
        <h1>ColorTextGame</h1>
        <p class="desc">è¨˜æ†¶æ–‡å­—èˆ‡é¡è‰²</p>
    </header>

    <div class="controls-wrapper">
        <div class="difficulty-bar">
            <button class="mode-btn active" onclick="setMode('easy', 4, this)">ç°¡å–®</button>
            <button class="mode-btn" onclick="setMode('medium', 6, this)">ä¸­ç­‰</button>
            <button class="mode-btn" onclick="setMode('hard', 9, this)">å›°é›£</button>
        </div>
        
        <div class="status-bar">
            <div class="score-box">
                é€£å°: <span id="streak-score" class="score-val">0</span>
            </div>
            
            <div class="timer-toggle">
                <span>è¨ˆæ™‚ (8ç§’)</span>
                <label class="switch">
                    <input type="checkbox" id="timer-mode-check">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>

    <div id="game-container">
        <div id="grid" class="grid"></div>
        
        <div id="result-overlay" class="result-overlay">
            <div id="result-icon" class="result-title">ğŸ‰</div>
            <div id="result-text" class="result-sub">ç­”å°äº†ï¼</div>
            <button class="btn-main" style="width: auto; padding: 12px 30px;" onclick="startGame()">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <div class="action-area">
        <button id="start-btn" class="btn-main" onclick="startGame()">é–‹å§‹è¨˜æ†¶</button>
        
        <div id="question-box" class="question-box">
            <div id="timer-bar-container" class="timer-bar-container">
                <div id="timer-bar-fill" class="timer-bar-fill"></div>
            </div>

            <div class="question-text">
                <div>å‰›å‰›æœ‰å¹¾å€‹...</div>
                <div id="question-content"></div>
            </div>
            
            <div class="numpad-container" id="numpad-container">
                </div>
        </div>
    </div>

    <script>
        // --- éŠæˆ²è¨­å®š ---
        const config = {
            easy: 4,
            medium: 6,
            hard: 9
        };
        
        const items = [
            { text: 'ç´…', class: 'c-red', name: 'ç´…è‰²' },
            { text: 'è—', class: 'c-blue', name: 'è—è‰²' },
            { text: 'ç¶ ', class: 'c-green', name: 'ç¶ è‰²' },
            { text: 'é»ƒ', class: 'c-yellow', name: 'é»ƒè‰²' },
            { text: 'é»‘', class: 'c-black', name: 'é»‘è‰²' }
        ];

        let currentMode = 'easy';
        let currentCount = 4;
        let gameData = [];
        let correctAnswer = 0;
        let timerId = null;
        let currentStreak = 0;

        // --- åŠŸèƒ½å¯¦ä½œ ---

        function setMode(mode, count, btnElement) {
            currentMode = mode;
            currentCount = count;
            
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
            
            resetGameUI();
            updateStreak(0, true); 
        }

        function resetGameUI() {
            document.getElementById('grid').innerHTML = '';
            document.getElementById('question-box').style.display = 'none';
            document.getElementById('start-btn').style.display = 'block';
            document.getElementById('result-overlay').style.display = 'none';
            document.getElementById('timer-bar-container').style.display = 'none';
            
            const fill = document.getElementById('timer-bar-fill');
            fill.style.animation = 'none';
            if (timerId) clearTimeout(timerId);
        }

        function updateStreak(val, isReset = false) {
            if (isReset) {
                currentStreak = val;
            } else {
                currentStreak += val;
            }
            document.getElementById('streak-score').innerText = currentStreak;
        }

        function startGame() {
            resetGameUI();
            document.getElementById('start-btn').style.display = 'none';
            
            // 1. ç”Ÿæˆèˆ‡æ’ç‰ˆ
            gameData = [];
            const gridEl = document.getElementById('grid');
            gridEl.innerHTML = '';
            
            if (currentMode === 'hard') {
                gridEl.style.gridTemplateColumns = 'repeat(3, 1fr)'; 
            } else {
                gridEl.style.gridTemplateColumns = 'repeat(2, 1fr)';
            }

            for (let i = 0; i < currentCount; i++) {
                const textObj = items[Math.floor(Math.random() * items.length)];
                const colorObj = items[Math.floor(Math.random() * items.length)];
                
                gameData.push({
                    text: textObj.text,
                    colorClass: colorObj.class,
                    colorName: colorObj.name
                });

                const card = document.createElement('div');
                card.className = `card ${colorObj.class}`;
                card.innerText = textObj.text;
                gridEl.appendChild(card);
            }

            // 2. è¨ˆç®—åœç•™æ™‚é–“
            let memoryTime = 2000;
            if (currentMode === 'easy') memoryTime = 3000; 
            if (currentMode === 'medium') memoryTime = 6000;
            if (currentMode === 'hard') memoryTime = 10000;
            
            setTimeout(() => {
                hideGridAndAsk();
            }, memoryTime);
        }

        function hideGridAndAsk() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.innerText = '?';
                card.className = 'card';
                card.style.color = '#DDD';
            });

            generateQuestion();
        }

        function generateQuestion() {
            const type = Math.random() > 0.5 ? 'color' : 'text';
            const targetItem = items[Math.floor(Math.random() * items.length)];
            const qContent = document.getElementById('question-content');
            
            let questionHtml = '';
            correctAnswer = 0;

            if (type === 'color') {
                // é¡¯ç¤ºåœ“å½¢è‰²å¡Šï¼Œç„¡é™°å½±
                const hexColor = getColorCode(targetItem.class);
                questionHtml = `å­—é«”é¡è‰²æ˜¯ <span class="q-color-dot" style="background-color:${hexColor}"></span>`;
                correctAnswer = gameData.filter(d => d.colorName === targetItem.name).length;
            } else {
                // æ–‡å­—å…§å®¹
                questionHtml = `<span class="q-content-text">æ–‡å­—å…§å®¹æ˜¯ ã€Œ${targetItem.text}ã€</span>`;
                correctAnswer = gameData.filter(d => d.text === targetItem.text).length;
            }

            qContent.innerHTML = questionHtml;
            document.getElementById('question-box').style.display = 'block';

            // ç”Ÿæˆéµç›¤
            const numpadContainer = document.getElementById('numpad-container');
            numpadContainer.innerHTML = '';

            if (currentMode === 'hard') {
                const row1 = document.createElement('div');
                row1.className = 'numpad-row';
                for(let i=0; i<=4; i++) row1.appendChild(createNumBtn(i));
                
                const row2 = document.createElement('div');
                row2.className = 'numpad-row';
                for(let i=5; i<=9; i++) row2.appendChild(createNumBtn(i));

                numpadContainer.appendChild(row1);
                numpadContainer.appendChild(row2);

            } else {
                const row = document.createElement('div');
                row.className = 'numpad-row';
                row.style.flexWrap = 'wrap';
                for(let i=0; i<=currentCount; i++) row.appendChild(createNumBtn(i));
                numpadContainer.appendChild(row);
            }

            // 3. è™•ç†è¨ˆæ™‚æ¨¡å¼
            const isTimerMode = document.getElementById('timer-mode-check').checked;
            if (isTimerMode) {
                startTimer();
            }
        }

        function createNumBtn(num) {
            const btn = document.createElement('button');
            btn.className = 'num-btn';
            btn.innerText = num;
            btn.onclick = () => checkAnswer(num);
            return btn;
        }

        function startTimer() {
            const barContainer = document.getElementById('timer-bar-container');
            const fill = document.getElementById('timer-bar-fill');
            
            barContainer.style.display = 'block';
            fill.style.animation = 'none';
            fill.offsetHeight; 
            // 8ç§’è¨ˆæ™‚
            fill.style.animation = 'timerShrink 8s linear forwards';

            timerId = setTimeout(() => {
                checkAnswer(-1); // å‚³å…¥ -1 ä»£è¡¨è¶…æ™‚
            }, 8000);
        }

        function checkAnswer(userAns) {
            if (timerId) clearTimeout(timerId);
            const fill = document.getElementById('timer-bar-fill');
            fill.style.animationPlayState = 'paused';

            let isSuccess = false;
            let msg = '';

            if (userAns === -1) {
                isSuccess = false;
                msg = 'æ™‚é–“åˆ°ï¼åæ‡‰å¤ªæ…¢å›‰ï¼';
                updateStreak(0, true);
            } else if (userAns === correctAnswer) {
                isSuccess = true;
                msg = 'ç­”å°äº†ï¼è¨˜æ†¶åŠ›è¶…å¼·ï¼';
                updateStreak(1);
            } else {
                isSuccess = false;
                msg = `ç­”éŒ¯å›‰ï¼Œæ­£ç¢ºæ˜¯ ${correctAnswer} å€‹`;
                updateStreak(0, true);
            }

            showResult(isSuccess, msg);
        }

        function showResult(isSuccess, msg) {
            const overlay = document.getElementById('result-overlay');
            const icon = document.getElementById('result-icon');
            const text = document.getElementById('result-text');

            icon.innerText = isSuccess ? 'ğŸ˜' : 'ğŸ˜µ';
            text.innerText = msg;
            text.style.color = isSuccess ? 'var(--primary-blue)' : '#E63946';

            overlay.style.display = 'flex';
        }

        function getColorCode(className) {
            switch(className) {
                case 'c-red': return '#E63946';
                case 'c-green': return '#2A9D8F';
                case 'c-blue': return '#53B4FF'; 
                case 'c-yellow': return '#F4A261';
                case 'c-black': return '#333333';
                default: return '#000';
            }
        }
        
        // åˆå§‹åŒ–
        updateStreak(0, true);

    </script>
</body>
</html>